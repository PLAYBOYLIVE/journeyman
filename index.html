<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Our Love Map üíï</title>

  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;700&family=Pacifico&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <style>
    :root{
      --bg1:#fff4fb;
      --bg2:#f7fcff;
      --ink:#41364b;
      --pink:#ff7aa2;
      --rose:#ff4d88;
      --lav:#a38bff;
      --mint:#9be7d6;
      --card:#ffffffcc;
      --shadow: 0 8px 24px rgba(0,0,0,.12);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body {
      font-family: 'Quicksand', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji';
      color: var(--ink);
      background: radial-gradient(1200px 800px at 15% -10%, var(--bg1), transparent 60%),
                  radial-gradient(1200px 800px at 110% 10%, var(--bg2), transparent 60%),
                  #fff;
      overflow: hidden;
    }




    /* Header */
    .header {
      position: absolute; z-index: 1000; left: 16px; top: 16px;
      backdrop-filter: blur(8px);
      background: var(--card);
      padding: 12px 16px; border-radius: 16px; box-shadow: var(--shadow);
      display: flex; align-items: center; gap: 12px;
    }
    .logo { font-family: 'Pacifico', cursive; font-size: 20px; color: var(--rose); }
    .tag { font-size: 12px; opacity: .8; }
    .btn {
      border: 0; border-radius: 999px; padding: 8px 14px; cursor: pointer;
      background: linear-gradient(135deg, var(--pink), var(--lav)); color: white; font-weight: 700;
      box-shadow: var(--shadow); transition: transform .12s ease;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn.ghost { background: #fff; color: var(--rose); border: 2px solid var(--rose); }

    
    .panel {
      position: absolute; z-index: 1000; right: 16px; top: 16px; width: 280px;
      max-height: calc(100% - 32px); overflow: auto;
      backdrop-filter: blur(8px); background: var(--card); border-radius: 16px; box-shadow: var(--shadow);
      padding: 14px; display: grid; gap: 10px;
    }
    .panel h3 { margin: 2px 0 4px; font-size: 16px; }
    .spot { display: grid; grid-template-columns: auto 1fr auto; gap: 8px; align-items: center;
      padding: 8px; border-radius: 12px; background: #fff; box-shadow: inset 0 0 0 2px #f6e7ef; }
    .dot { width: 16px; height: 16px; border-radius: 50%; background: var(--rose); box-shadow: 0 0 0 4px rgba(255,77,136,.12); }
    .spot-title { font-weight: 700; }
    .tiny { font-size: 11px; opacity: .7; }

    #map { position: absolute; inset: 0; }
    .leaflet-container { font: inherit; }

    
    .leaflet-popup-content-wrapper { border-radius: 16px; box-shadow: var(--shadow); }
    .leaflet-popup-content { margin: 10px 12px; font-size: 14px; }
    .popup-title { font-weight: 800; color: var(--rose); font-size: 16px; margin-bottom: 4px; }
    .popup-note { line-height: 1.45; }
    .popup-photo { width: 100%; border-radius: 12px; margin-top: 8px; box-shadow: 0 6px 14px rgba(0,0,0,.1); }

    
    @keyframes pop {
      0% { transform: translateY(0) scale(1); }
      40% { transform: translateY(-6px) scale(1.06); }
      100% { transform: translateY(0) scale(1); }
    }
    .bounce { animation: pop .4s ease; }

    
    .float-heart { position: absolute; pointer-events: none; font-size: 16px; opacity: 0; transform: translateY(0);
      transition: opacity .6s, transform .8s; }

    /* Music pill */
    .music { display:flex; align-items:center; gap:8px; font-size:12px; }
    .music-ind { width:8px; height:8px; border-radius:50%; background: #bbb; box-shadow: 0 0 0 6px rgba(255,122,162,.15); }
    .music.playing .music-ind { background: var(--rose); box-shadow: 0 0 0 6px rgba(255,122,162,.3); }

    /* Scrollbar subtle */
    .panel::-webkit-scrollbar{ width:10px }
    .panel::-webkit-scrollbar-thumb{ background:#f1d9e3; border-radius:999px }
  </style>
</head>
<body>
  <!-- Header / Controls -->
  <div class="header">
    <div>
      <div class="logo">Our Love Map</div>
      <div class="tag">places that made us, us ‚ú®</div>
    </div>
    <button id="fitBtn" class="btn" title="Zoom to all hearts">Fit hearts</button>
    <button id="aboutBtn" class="btn ghost" title="How it works">About</button>
  </div>

  <!-- Right-side panel listing spots -->
  <aside class="panel" id="listPanel">
    <h3>Our Spots üíò</h3>
    <div id="spotList"></div>
    <div class="music" id="musicPill">
      <div class="music-ind"></div>
      <span id="musicTxt">music off</span>
      <button id="musicBtn" class="btn" style="margin-left:auto; padding:6px 10px">Toggle</button>
    </div>
  </aside>

  <!-- Map -->
  <div id="map"></div>

  <!-- Floating hearts container -->
  <div id="floaters"></div>


  <audio id="bgm" loop preload="metadata">
    <source src="song.mp3" type="audio/mpeg">
    Your browser doesn‚Äôt support audio.
  </audio>

  
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script>
    // === EDIT THESE: your city and your special places ===
    const MAP_CENTER = [43.668019, -79.507522]; // set to toronto
    const MAP_ZOOM   = 10;

    // Define your special places here. Add as many as you like.
    // lat, lng, title, note, optional photo (local path or https)
    const PLACES = [
      { lat:43.637227, lng:-79.460847, title:"Where We Made it Official üíï", note:"A moment when even the rain couldn't take away from our love.", photo:"" },
      { lat:43.259991, lng:-79.922400, title:"Our First Encounter üéÉ", note:"FMSA Halo-Halloween 2021 - where our paths crossed for the first time.", photo:"" },
      { lat:43.238265, lng:-79.958105, title:"The Magic of Tiffany Falls", note:"Even an evil snow storm couldn't cloud the magical moment of our kiss here.", photo:"" },
    ];

    // === Cute heart icon as an SVG data URL which did NOT WORK AT ALL
    const heartSVG = encodeURIComponent(`
      <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'>
        <defs>
          <linearGradient id='g' x1='0' x2='1' y1='0' y2='1'>
            <stop offset='0%' stop-color='#ff7aa2'/>
            <stop offset='100%' stop-color='#a38bff'/>
          </linearGradient>
        </defs>
        <path d='M32 56s-4.6-3.86-11.7-10.4C10.6 36.9 4 31 4 22.9 4 16 9.4 10 16.6 10 21.5 10 25 12.8 27 15.9 29 12.8 32.5 10 37.4 10 44.6 10 50 16 50 22.9c0 8.1-6.6 14-16.3 22.7C36.6 52.1 32 56 32 56z' fill='url(#g)' stroke='#ff4d88' stroke-width='2' />
      </svg>`);

    const HeartIcon = L.icon({
      iconUrl: `data:image/svg+xml;charset=UTF-8,${heartSVG}`,
      iconSize: [36, 36],
      iconAnchor: [18, 30],
      popupAnchor: [0, -26]
    });

    // === Map setup ===
    const map = L.map('map', { zoomControl: false });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);
    L.control.zoom({ position: 'bottomright' }).addTo(map);

    map.setView(MAP_CENTER, MAP_ZOOM);

    const markers = [];
    const bounds = [];

    function makePopupHTML(p){
      const img = p.photo ? `<img class="popup-photo" src="${p.photo}" alt="${p.title}">` : '';
      return `<div class="popup">
        <div class="popup-title">${p.title}</div>
        <div class="popup-note">${p.note}</div>
        ${img}
      </div>`;
    }

    function spawnFloatHeart(x, y){
      const el = document.createElement('div');
      el.className = 'float-heart';
      el.textContent = '‚ù§';
      el.style.left = x + 'px';
      el.style.top  = y + 'px';
      document.body.appendChild(el);
      requestAnimationFrame(() => {
        el.style.opacity = 1;
        el.style.transform = 'translateY(-40px)';
      });
      setTimeout(() => el.remove(), 900);
    }

    PLACES.forEach((p, idx) => {
      const m = L.marker([p.lat, p.lng], { icon: HeartIcon }).addTo(map);
      m.bindPopup(makePopupHTML(p));
      m.on('click', (ev) => {
        const icon = ev.target._icon; if(icon){ icon.classList.add('bounce'); setTimeout(()=>icon.classList.remove('bounce'), 450); }
        const pt = ev.originalEvent ? {x: ev.originalEvent.clientX, y: ev.originalEvent.clientY} : {x: window.innerWidth/2, y: window.innerHeight/2};
        spawnFloatHeart(pt.x, pt.y);
      });
      markers.push(m);
      bounds.push([p.lat, p.lng]);
    });

    // Fit to all hearts
    const fitBtn = document.getElementById('fitBtn');
    fitBtn.addEventListener('click', () => {
      if(bounds.length){ map.fitBounds(bounds, { padding: [60,60] }); }
    });

    // Build right-side list
    const list = document.getElementById('spotList');
    PLACES.forEach((p, i) => {
      const row = document.createElement('div');
      row.className = 'spot';
      row.innerHTML = `<div class='dot'></div><div><div class='spot-title'>${p.title}</div><div class='tiny'>${p.note}</div></div><button class='btn' style='padding:6px 10px'>Go</button>`;
      row.querySelector('button').addEventListener('click', () => {
        map.flyTo([p.lat, p.lng], 15, { animate: true, duration: 0.8 });
        map.once('moveend', () => {
          markers[i].openPopup();
          const sidebarW = (document.getElementById('listPanel')?.offsetWidth || 0);
        });
      });
      list.appendChild(row);
    });

    // About button
    document.getElementById('aboutBtn').addEventListener('click', () => {
      alert('Click the hearts to read our little memories. Use the list to jump to a spot. Add more places by editing the PLACES array in the code. üíù');
    });

    // Optional background music toggle (add a file path to the <audio> src above)
    const bgm = document.getElementById('bgm');
    const musicBtn = document.getElementById('musicBtn');
    const musicPill = document.getElementById('musicPill');
    const musicTxt = document.getElementById('musicTxt');
    musicBtn.addEventListener('click', async () => {
      try {
        if (bgm.paused) {
          // Ensure the browser is ready to play the current source
          bgm.load();
          await bgm.play();          // first tap = user gesture ‚Üí allowed on mobile
          musicPill.classList.add('playing');
          musicTxt.textContent = 'music on';
        } else {
          bgm.pause();
          musicPill.classList.remove('playing');
          musicTxt.textContent = 'music off';
        }
      } catch (e) {
        console.error('Audio play error:', e, 'currentSrc:', bgm.currentSrc);
        alert('Could not play. Make sure song.mp3 is next to this HTML (same folder), then tap Toggle again.');
      }
    });
  </script>
</body>
</html>
